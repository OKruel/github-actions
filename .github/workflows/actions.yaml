#! EXAMPLE TO RUN ACTIONS
# Notice that the Actions DO NOT COPY the files from the repository to the Virtual Machine.
# This copy procedure must be done either manually or by bringing in the checkout action
# Github has an oficial ready to use Actions repository -> https://github.com/actions/
# Events that can trigger a workflow https://docs.github.com/en/actions/learn-github-actions/events-that-trigger-workflows

name: Actions workflow
# Object (can also be an array) that specifies in which External or Github EVENTS the jobs will be triggerred
on:
  # Events can be dispatch manually by making a post request to a URL.
  # This request must contain an authorization token to your repo.
  # This token can be generated in the settings -> developer settings > personal access tokens
  # Docs https://docs.github.com/en/rest/reference/repos#create-a-repository-dispatch-event
  repository_dispatch:
    # You can add any string here as a type.
    # In the body of the post request the string must be sent. {"event_type": "build"}
    types: ['build']

  # CRON Jobs - The schedule works exacty like Linux Cron jobs
  #* schedule:
  # CRON job utility tool -> https://crontab.guru/
  # Is possible to set several CRON jobs
  # Minimum time aceptable to GITHUB is 5min to 5min
  #* - cron: '0/5 * * * *'
  #* - cron: '* * * * * '

  # Every push (branch not specified) will trigger the jobs
  # push:
  #! IMPORTANT - When a PR is open Github will create internally a REF branch version .
  #! The REF consists in an actual merge.
  #! The JOBS will then run in the MERGED CODE
  #! This happens for all types in pull_request
  pull_request:
    # Indicated which pull requests events will trigger the jobs
    types: [closed, assigned, opened, reopened]

jobs:
  github-actions:
    runs-on: ubuntu-latest
    steps:
      # [COMMAND] Exposes the  environment variables automatically created in the virtual machine
      - name: GITHUB ENV VARIABLES
        # SHA = current commit;
        # github.token = your personal token used to authenticate to your repo (SSH)
        run: |
          echo $GITHUB_SHA 
          echo $GITHUB_REPOSITORY
          echo $GITHUB_WORKSPACE
          echo "${{ github.token }}"

      # [ACTION] Copies all files to inside the github virtual machine
      - name: Github CHECKOUT ACTION - bring in the repo files
        # Name of the repository to use the code.
        uses: actions/checkout@v2.4.0 # <user/repository>@<EITHER VERSION OR COMMIT OR BRANCH>

      # [COMMAND] Check if the my repository files are inside the virtual machine after CHECKOUT ACTION
      - name: AFTER CHECKOUT ACTION - List files inside the virtual machine
        run: |
          pwd
          ls -la

      # [ACTION] Receives and input and print it to the console
      - name: Simple Javascript Action
        # Code inside a repository to execute/build/test
        uses: actions/hello-world-javascript-action@v1 # <user/repository>@<EITHER VERSION OR COMMIT OR BRANCH>
        # ID given to identify this repo in future jobs/steps in this file
        id: greet
        # Actions can take inputs. You can instructions in the repository
        with:
          # This is the input
          who-to-greet: Olavo

      #[COMMAND] Command to test the sintax to acces other steps from this workflow
      - name: Log the time of the Greeting
        # Steps becomes an object that can be accessed through the following syntax
        run: echo "${{ steps.greet.outputs.time }}"
